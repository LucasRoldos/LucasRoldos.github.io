<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1e40af">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Nuestras Memorias - Libro de Aventuras</title>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pirata+One&family=Kalam:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --ocean-blue: #1e40af;
            --ocean-light: #3b82f6;
            --gold: #fbbf24;
            --gold-dark: #f59e0b;
            --coral: #ef4444;
            --sand: #fef3c7;
            --wood: #92400e;
            --parchment: #fef3c7;
        }
        
        body {
            font-family: 'Kalam', cursive;
            background: url('fondo.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Actualizar también el fondo de las olas */
        .ocean-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('fondo.jpg') no-repeat center center fixed;
            background-size: cover;
            opacity: 0.3;
            animation: waves 30s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes waves {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        /* Header principal */
        .header {
            background: linear-gradient(135deg, var(--wood) 0%, #7c2d12 100%);
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '☠';
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 30px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }
        
        .header::after {
            content: '⚓';
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 30px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite reverse;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-10px) rotate(10deg); }
        }
        
        .app-title {
            font-family: 'Pirata One', cursive;
            font-size: 2.5em;
            color: var(--gold);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: var(--sand);
            font-size: 0.9em;
        }
        
        /* Navegación principal */
        .main-nav {
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            margin: 10px;
            border-radius: 15px;
        }
        
        .nav-btn {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            color: var(--wood);
            font-weight: bold;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .nav-btn:active {
            transform: scale(0.95);
        }
        
        .nav-btn.active {
            background: linear-gradient(135deg, var(--coral) 0%, #dc2626 100%);
            color: white;
        }
        
        /* Contenedor principal */
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Vista de pantallas */
        .view {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .view.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Personaje guía */
        .character-guide {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid var(--gold);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .character-guide::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 10px solid white;
        }
        
        .character-avatar {
            width: 60px;
            height: 60px;
            background: var(--coral);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin-right: 15px;
            vertical-align: middle;
            border: 3px solid var(--gold);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            animation: bounce 2s infinite;
        }
        
        .char-avatar-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
            vertical-align: middle;
            border: 3px solid var(--gold);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            /* Agregar fondo rojo detrás de la imagen */
            background: var(--coral);
            padding: 2px; /* Espacio entre la imagen y el borde */
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .character-message {
            flex: 1;
            color: var(--wood);
            font-size: 1.1em;
            line-height: 1.4;
        }
        
        /* Galería de memorias */
        .memories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .memory-card {
            background: linear-gradient(135deg, var(--parchment) 0%, #fef3c7 100%);
            border: 3px solid var(--wood);
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .memory-card:hover {
            transform: translateY(-5px) rotate(-2deg);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        
        .memory-card::before {
            content: 'WANTED';
            position: absolute;
            top: 5px;
            left: 50%;
            transform: translateX(-50%);
            color: var(--coral);
            font-family: 'Pirata One', cursive;
            font-size: 0.8em;
            opacity: 0.5;
        }
        
        .memory-thumbnail {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
            margin-top: 20px;
            background: #f3f4f6;
        }
        
        .memory-title {
            font-weight: bold;
            color: var(--wood);
            margin-top: 10px;
            font-size: 0.9em;
            text-align: center;
        }
        
        .memory-date {
            font-size: 0.7em;
            color: var(--coral);
            text-align: center;
            margin-top: 5px;
        }
        

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .add-btn:active {
            transform: scale(0.95);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 200;
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Estilos para las flechas de navegación */
        .nav-arrows {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            pointer-events: none;
            z-index: 10;
        }
        
        .nav-arrow {
            background: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            pointer-events: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .nav-arrow:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }
        
        .nav-arrow:active {
            transform: scale(0.9);
        }
        
        .nav-arrow:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--parchment) 0%, white 100%);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 5px solid var(--gold);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--coral);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .modal-close:hover {
            transform: rotate(90deg);
        }
        
        /* Formulario */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--wood);
            font-weight: bold;
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gold);
            border-radius: 10px;
            font-family: 'Kalam', cursive;
            font-size: 1em;
            background: rgba(255,255,255,0.8);
            transition: border-color 0.3s;
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--coral);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-input-label {
            display: block;
            padding: 12px;
            background: linear-gradient(135deg, var(--ocean-blue) 0%, var(--ocean-light) 100%);
            color: white;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
        }
        
        .form-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--wood);
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(251, 191, 36, 0.4);
        }
        
        /* Vista detalle */
        .detail-view {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            border: 5px solid var(--gold);
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        /* Contenedor de imagen para centrar */
        .image-container {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .detail-image {
            max-width: 100%;
            height: auto;
            max-height: 400px;
            border-radius: 10px;
            object-fit: contain;
        }
        
        .detail-image iframe {
            border: none;
            border-radius: 8px;
        }
        
        .detail-title {
            font-family: 'Pirata One', cursive;
            font-size: 2em;
            color: var(--wood);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .detail-date {
            color: var(--coral);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .detail-description {
            color: var(--wood);
            line-height: 1.6;
            padding: 20px;
            background: var(--parchment);
            border-radius: 10px;
            border: 2px dashed var(--gold);
        }
        
        /* Estadísticas */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.7) 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 3px solid var(--gold);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--coral);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--wood);
            font-size: 0.9em;
        }
        


        
        /* Success message */
        .success-message {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-title {
                font-size: 2em;
            }
            
            .memories-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 15px;
            }
            
            .add-btn, .creator-mode-btn {
                width: 60px;
                height: 60px;
                font-size: 25px;
                bottom: 20px;
            }
            
            .add-btn {
                right: 20px;
            }
            
            .creator-mode-btn {
                left: 20px;
            }
            
            /* Estilos para el comentario de personaje en móvil */
            .nav-arrows {
                padding: 0 5px;
            }
            
            .nav-arrow {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
            
            /* Comentario adaptado para móvil */
            [style*="display: flex"] img {
                width: 35px !important;
                height: 35px !important;
            }
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid var(--gold);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: white;
        }
        
        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state-message {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .empty-state-submessage {
            opacity: 0.8;
        }
        /* Estilos del Login */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-content {
            background: linear-gradient(135deg, var(--parchment) 0%, white 100%);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            border: 5px solid var(--gold);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            text-align: center;
        }

        .login-title {
            font-family: 'Pirata One', cursive;
            font-size: 2em;
            color: var(--wood);
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: var(--coral);
            margin-bottom: 30px;
            font-size: 1.1em;
        }

        .login-form {
            text-align: left;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            border: none;
            border-radius: 25px;
            color: var(--wood);
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(251, 191, 36, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--coral);
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Modal de Login -->
    <div id="loginModal" class="login-modal active">
        <div class="login-content">
            <h2 class="login-title">🔐 Quien chota so bo, solo ababa pasa</h2>
            <p class="login-subtitle">Pone el usuario y la contra que te di en el papeel</p>
            
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label class="form-label">Usuario</label>
                    <input type="text" id="usernameInput" class="form-input" placeholder="Ingresa tu usuario" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Contraseña</label>
                    <input type="password" id="passwordInput" class="form-input" placeholder="Ingresa tu contraseña" required>
                </div>
                
                <div id="loginError" class="login-error" style="display: none;">
                    ❌ Usuario o contraseña incorrectos
                </div>
                
                <button type="submit" class="login-btn">Entrar a la sorpresa</button>
            </form>
        </div>
    </div>
    
    <!-- Contenedor principal (oculto hasta autenticación) -->
    <div id="mainContent" style="display: none;">
        <div class="ocean-bg"></div>
    
    <header class="header">
        <h1 class="app-title">🏴‍☠️ Nuestras Memorias</h1>
        <p class="subtitle">Libro de aventuras piratas</p>
    </header>
    
    <nav class="main-nav">
        <button class="nav-btn active" onclick="showView('home')">🏠 Inicio</button>
        <button class="nav-btn" onclick="showView('gallery')">📸 Galería</button>
    </nav>
    
    <div class="container">
        <!-- Vista Home -->
        <div id="home" class="view active">
            <div class="character-guide">
                <img src="luffy.png" alt="Luffy" class="char-avatar-img">
                <span class="character-message" id="welcomeMessage">
                    ¡Yosh! ¡Bienvenido a nuestro libro de aventuras! ¡Aquí guardamos algunos de nuestros increíbles recuerdos juntos!
                </span>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">📷</div>
                    <div class="stat-number" id="totalMemories">0</div>
                    <div class="stat-label">Memorias Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🎬</div>
                    <div class="stat-number" id="totalVideos">0</div>
                    <div class="stat-label">Videos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📅</div>
                    <div class="stat-number" id="daysOfAdventure">0</div>
                    <div class="stat-label">Días de Aventura</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⭐</div>
                    <div class="stat-number" id="favoriteCharacter">Zoro</div>
                    <div class="stat-label">Personaje Favorito</div>
                </div>
            </div>
           
        </div>
        
        <!-- Vista Galería -->
        <div id="gallery" class="view">
            <div class="character-guide">
                <span class="character-avatar" id="galleryCharAvatar">🧭</span>
                <span class="character-message" id="galleryCharMessage">
                    ¡Aquí están todos nuestros preciosos recuerdos! Cada uno cuenta una historia única de nuestra aventura.
                </span>
            </div>
            
            <div id="memoriesContainer" class="memories-grid">
                <!-- Las memorias se cargarán aquí -->
            </div>
            
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">📭</div>
                <div class="empty-state-message">¡No hay memorias aún!</div>
                <div class="empty-state-submessage" id="emptyStateSubmessage">Pronto se añadirán nuevas aventuras</div>
            </div>
        </div>
    </div>
    

    <!-- Modal de detalle -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeDetailModal()">✕</button>
            <div id="detailContent">
                <!-- El contenido se cargará dinámicamente -->
            </div>
        </div>
    </div>
    
    </div><!-- /mainContent -->

    <script>
        // Credenciales de acceso
        const VALID_USERNAME = 'ababa';
        const VALID_PASSWORD = 'akamaru1';

        // Manejar el formulario de login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('usernameInput').value.trim();
            const password = document.getElementById('passwordInput').value.trim();
            
            if (username === VALID_USERNAME && password === VALID_PASSWORD) {
                // Login exitoso
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // Guardar estado de sesión en localStorage
                localStorage.setItem('nakamaLoggedIn', 'true');
                
                // Inicializar la aplicación
                initApp();
            } else {
                // Mostrar error
                document.getElementById('loginError').style.display = 'block';
                
                // Limpiar campos y enfocar
                document.getElementById('usernameInput').value = '';
                document.getElementById('passwordInput').value = '';
                document.getElementById('usernameInput').focus();
            }
        });

        // Verificar si el usuario ya está logueado al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('nakamaLoggedIn') === 'true';
            
            if (isLoggedIn) {
                // Usuario ya autenticado
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initApp();
            } else {
                // Mostrar login
                document.getElementById('usernameInput').focus();
            }
        });

        // Función para obtener un comentario aleatorio de un personaje
function getRandomCharacterComment() {
    const randomCharacter = characters[Math.floor(Math.random() * characters.length)];
    const comments = characterComments[randomCharacter.name];
    const randomComment = comments[Math.floor(Math.random() * comments.length)];
    
    return {
        character: randomCharacter.name,
        avatar: randomCharacter.avatar,
        comment: randomComment
    };
}

        // Comentarios personalizados para cada personaje
const characterComments = {
    'Luffy': [
        '¡Esta aventura fue tan épica como encontrar el One Piece!',
        '¡Shishishi! Qué día tan divertido tuvimos!',
        '¡Esta memoria me hace querer gritar "¡Soy yo, Luffy!"!',
        '¡Wooo! ¡Qué aventura tan increíble!',
        '¡Esta foto captura la esencia de nuestra tripulación!'
    ],
    'Zoro': [
        'Un momento digno de recordar, como mi sueño de ser el mejor espadachín.',
        'Esta memoria tiene el filo de una buena espada.',
        'Un día que vale la pena proteger con mi vida.',
        'Incluso yo podría perderme en este recuerdo.',
        'Un momento que honra nuestra promesa como nakama.'
    ],
    'Nami': [
        '¡Este recuerdo vale más que cualquier mapa del tesoro!',
        '¡Qué día perfecto para navegar juntos!',
        'Esta memoria brilla más que mis Belly.',
        'Un momento que navegaría mil veces en mi mente.',
        '¡Qué clima perfecto para esta aventura!'
    ],
    'Usopp': [
        '¡Esta historia es tan épica como mis 8000 seguidores!',
        '¡El gran Usopp aprueba esta memoria épica!',
        '¡Incluso mis ballestas no podrían disparar un momento más perfecto!',
        '¡Esta aventura es más emocionante que cualquiera de mis historias!',
        '¡Mis nakama serían tan orgullosos de este momento!'
    ],
    'Sanji': [
        '¡Esta memoria está más dulce que cualquier postre!',
        '¡Mellorine! ¡Qué momento tan hermoso!',
        'Un día que merece un banquete de celebración.',
        'Esta memoria tiene el sabor perfecto de la aventura.',
        '¡Un momento que calienta el corazón más que mis patadas!'
    ],
    'Chopper': [
        '¡Wooo! ¡Qué recuerdo tan lindo y emocionante!',
        '¡Este momento me hace tan feliz que podría saltar!',
        '¡Una aventura digna de ser celebrada con chocolate!',
        '¡Qué día tan mágico para mis nakama!',
        '¡Esta memoria es tan dulce como las golosinas!'
    ],
    'Robin': [
        'Un momento precioso que merece ser preservado para siempre.',
        'La historia de nuestra aventura se vuelve más rica con este recuerdo.',
        'Un instante que trasciende el tiempo y el espacio.',
        'Esta memoria florece como las flores que tanto amo.',
        'Un momento que ilumina nuestra jornada como nakama.'
    ],
    'Franky': [
        '¡SÚPER! ¡Esta memoria es tan épica como mi cyborg!',
        '¡Esta aventura está más construida que mis mejores creaciones!',
        '¡OW! ¡Qué momento tan SÚPER!',
        '¡Esta memoria tiene más estilo que mis gafas!',
        '¡Un día que merece ser grabado en acero!'
    ],
    'Brook': [
        'Yohohoho, qué momento tan emotivo para mi alma.',
        '¡Aunque no tengo ojos, puedo ver lo hermoso de este recuerdo!',
        'Un instante que toca las cuerdas de mi corazón... ¡Ah, pero no tengo!',
        'Esta memoria es más dulce que cualquier canción.',
        '¡Un momento digno de ser cantado por toda la eternidad!'
    ]
};

// Characters y sus frases
const characters = [
    { name: 'Luffy', avatar: 'luffy.png', phrases: [
        '¡Esta memoria me da ganas de más aventuras!',
        '¡Qué recuerdo tan genial! ¡Vamos por más!',
        '¡Ja ja ja! ¡Esto es lo mejor!'
    ]},
    { name: 'Zoro', avatar: 'zoro.png', phrases: [
        'Un buen recuerdo para afilar la memoria',
        'No me perderé este momento',
        '¡Qué corte tan perfecto de aventura!'
    ]},
    { name: 'Nami', avatar: 'nami.png', phrases: [
        '¡Este recuerdo vale su peso en Berries!',
        'Navegando por memorias felices',
        '¡Qué clima perfecto para recordar!'
    ]},
    { name: 'Usopp', avatar: 'usopp.png', phrases: [
        '¡El gran capitán Usopp aprueba esta memoria!',
        '¡Qué historia tan épica!',
        '¡Mis 8000 seguidores estarían de acuerdo!'
    ]},
    { name: 'Sanji', avatar: 'sanji.png', phrases: [
        '¡Un recuerdo con sabor a aventura!',
        '¡Mellorine! ¡Qué memoria tan hermosa!',
        '¡Esto merece un banquete de celebración!'
    ]},
    { name: 'Chopper', avatar: 'chopper.png', phrases: [
        '¡Woooow! ¡Qué recuerdo tan lindo!',
        '¡Doctora! ¡Digo... qué memoria tan genial!',
        '¡Esto me hace muy feliz!'
    ]},
    { name: 'Robin', avatar: 'robin.png', phrases: [
        'Qué memoria tan preciosa para preservar',
        'La historia de esta aventura es fascinante',
        'Un momento que trasciende el tiempo'
    ]},
    { name: 'Franky', avatar: 'franky.png', phrases: [
        '¡SÚPER recuerdo!',
        '¡Esta memoria es SÚPER genial!',
        '¡OW! ¡Qué momento tan SÚPER!'
    ]},
    { name: 'Brook', avatar: 'brook.png', phrases: [
        'Yohohoho, qué momento tan emotivo',
        '¡Aunque no tengo ojos, puedo ver lo hermoso de este recuerdo!',
        '¡Esta memoria toca mi alma! ¡Ah, pero si no tengo! Yohohoho!'
    ]}
];
        
        // Estado de la aplicación
        let memories = [];
        let currentMemory = null;
        let isAuthenticated = false;
       
        
        // Inicializar la app
        function initApp() {
            loadMemories();
            updateStats();
            updateGallery();
            setRandomWelcomeMessage();
            
            // Configurar fecha actual por defecto
            const dateInput = document.getElementById('dateInput');
            if (dateInput) {
                dateInput.valueAsDate = new Date();
            }
        }

        // Agregar función de logout (opcional)
        function logout() {
            localStorage.removeItem('nakamaLoggedIn');
            location.reload(); // Recargar para mostrar login
        }

        
        // Cargar memorias del localStorage o del archivo JSON
function loadMemories() {
    // Primero intentar cargar del archivo JSON
    fetch('./memories.json')
        .then(response => response.json())
        .then(data => {
            memories = data;
            updateGallery();
            updateStats();
        })
        .catch(error => {
            console.error('Error cargando memorias:', error);
            // Si falla, intentar cargar del localStorage como respaldo
            const stored = localStorage.getItem('nakamaMemories');
            if (stored) {
                memories = JSON.parse(stored);
            } else {
                memories = [];
            }
            updateGallery();
            updateStats();
        });
}
        
        // Guardar memorias en localStorage
        function saveMemories() {
            localStorage.setItem('nakamaMemories', JSON.stringify(memories));
        }
        
        // Cambiar vista (ARREGLADO)
        function showView(viewName) {
            // Ocultar todas las vistas
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            // Mostrar vista seleccionada
            document.getElementById(viewName).classList.add('active');
            
            // Actualizar botones de navegación
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Encontrar el botón correcto y marcarlo como activo
            const buttons = document.querySelectorAll('.nav-btn');
            buttons.forEach(btn => {
                const buttonText = btn.textContent.toLowerCase();
                if ((viewName === 'home' && buttonText.includes('inicio')) || 
                    (viewName === 'gallery' && buttonText.includes('galería'))) {
                    btn.classList.add('active');
                }
            });
            
            // Actualizar mensaje del personaje según la vista
            if (viewName === 'gallery') {
                setRandomGalleryMessage();
            } else if (viewName === 'stats') {
                updateStatsMessage();
            }
        }
        
        // Establecer mensaje aleatorio de bienvenida (actualizado con Luffy)
        function setRandomWelcomeMessage() {
            const welcomeMessages = [
                '¡Yosh! ¡Bienvenido a nuestro libro de aventuras! ¡Aquí guardamos algunos de nuestros increíbles recuerdos juntos!',
                '¡Oi! ¡Es hora de navegar por nuestras memorias más preciadas!',
                '¡Prepárate para una aventura a través del tiempo y los recuerdos!'
            ];
            
            const welcomeElement = document.getElementById('welcomeMessage');
            if (welcomeElement) {
                welcomeElement.textContent = welcomeMessages[Math.floor(Math.random() * welcomeMessages.length)];
            }
            
            // Actualizar también el avatar del mensaje de bienvenida para usar siempre Luffy
            const welcomeAvatar = document.querySelector('#home .character-guide .character-avatar');
            if (welcomeAvatar) {
                welcomeAvatar.outerHTML = '<img src="luffy.png" alt="Luffy" class="char-avatar-img">';
            }
        }
        
        // Establecer mensaje aleatorio en galería (con círculo rojo alineado)
        function setRandomGalleryMessage() {
    const character = characters[Math.floor(Math.random() * characters.length)];
    document.getElementById('galleryCharAvatar').outerHTML = `
        <img src="${character.avatar}" alt="${character.name}" class="char-avatar-img">
    `;
    document.getElementById('galleryCharMessage').textContent = character.phrases[Math.floor(Math.random() * character.phrases.length)];
}
        
        // Actualizar mensaje de estadísticas
        function updateStatsMessage() {
            const messages = [
                '¡Cada memoria añadida es un tesoro más en nuestro cofre de recuerdos!',
                '¡Nuestra aventura crece con cada recuerdo que guardamos!',
                '¡El One Piece de los recuerdos está al alcance de nuestra mano!'
            ];
            document.getElementById('statsMessage').textContent = messages[Math.floor(Math.random() * messages.length)];
        }
        
        // Manejar selección de archivo
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentMemory = {
                        file: e.target.result,
                        type: file.type.startsWith('video') ? 'video' : 'image',
                        isGoogleDrive: false
                    };
                };
                reader.readAsDataURL(file);
                
                // Actualizar label
                document.querySelector('.file-input-label').textContent = file.name;
            }
        }
        
         
        
        // Abrir modal de detalle (CORREGIDO - eliminado movimiento horizontal)
        function openDetailModal(id) {
            const memoryIndex = getMemoryIndexById(id);
            const memory = memories[memoryIndex];
            if (!memory) return;
            
            let mediaHtml = '';
            if (memory.isGoogleDrive) {
                if (memory.type === 'video') {
                    mediaHtml = `<iframe src="https://drive.google.com/file/d/${memory.fileId}/preview" width="100%" height="300" allow="autoplay" frameborder="0"></iframe>`;
                } else {
                    const imageUrl = `https://drive.google.com/uc?export=view&id=${memory.fileId}`;
                    mediaHtml = `<img src="${imageUrl}" alt="${memory.title}" class="detail-image" onerror="this.onerror=null; this.src='https://drive.google.com/thumbnail?id=${memory.fileId}&sz=w800';">`;
                }
            } else if (memory.type === 'video') {
                mediaHtml = `<video src="${memory.file}" class="detail-image" controls autoplay></video>`;
            } else {
                mediaHtml = `<img src="${memory.file}" alt="${memory.title}" class="detail-image">`;
            }
            
            const sourceIndicator = memory.isGoogleDrive ? `<div style="text-align: center; margin-top: 5px; font-size: 0.8em; color: #64748b;">☁️ Alojado en Google Drive</div>` : '';
            
            // Obtener comentario aleatorio
            const characterComment = getRandomCharacterComment();
            
            // CORREGIDO: Determinar si mostrar flechas con lógica correcta
            const hasPrev = memoryIndex > 0; // Anterior si no es la primera
            const hasNext = memoryIndex < memories.length - 1; // Siguiente si no es la última
            
            const detailHtml = `
                <div class="nav-arrows">
                    <button class="nav-arrow" onclick="navigateMemory('prev')" ${!hasPrev ? 'disabled' : ''} title="Anterior">‹</button>
                    <button class="nav-arrow" onclick="navigateMemory('next')" ${!hasNext ? 'disabled' : ''} title="Siguiente">›</button>
                </div>
                
                <h2 class="detail-title">${memory.title}</h2>
                <p class="detail-date">Día ${memory.dayNumber} - ${new Date(memory.date).toLocaleDateString()}</p>
                
                <div class="image-container">
                    ${mediaHtml}
                </div>
                
                ${sourceIndicator}
                <p class="detail-description">${memory.description || 'Sin descripción disponible'}</p>
                
                <!-- Comentario de personaje -->
                <div style="margin-top: 20px; padding: 15px; background: var(--parchment); border-radius: 10px; border: 2px dashed var(--gold); display: flex; align-items: center; gap: 10px;">
                    <img src="${characterComment.avatar}" alt="${characterComment.character}" style="width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--gold);">
                    <div>
                        <strong style="color: var(--wood); font-size: 0.9em;">${characterComment.character} dice:</strong>
                        <p style="color: var(--wood); margin: 0; font-size: 0.9em; line-height: 1.4;">${characterComment.comment}</p>
                    </div>
                </div>
            `;
            
            document.getElementById('detailContent').innerHTML = detailHtml;
            document.getElementById('detailModal').setAttribute('data-current-id', id);
            document.getElementById('detailModal').classList.add('active');
        }
        // Función para obtener índice de memoria por ID
        function getMemoryIndexById(id) {
            return memories.findIndex(m => m.id === id);
        }
        
        // Función para navegar entre memorias (CORREGIDA)
        function navigateMemory(direction) {
            const currentId = document.getElementById('detailModal').getAttribute('data-current-id');
            const currentIndex = getMemoryIndexById(currentId);
            
            let newIndex;
            if (direction === 'prev') {
                newIndex = currentIndex - 1; // Ahora prev va a la memoria anterior (índice menor)
            } else {
                newIndex = currentIndex + 1; // Ahora next va a la memoria siguiente (índice mayor)
            }
            
            if (newIndex >= 0 && newIndex < memories.length) {
                openDetailModal(memories[newIndex].id);
            }
        }
        
        // Cerrar modal de detalle
        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
        }


        // Mostrar reacción del personaje
        function showCharacterReaction(message, avatarPath) {  // Modificado para recibir path en lugar de emoji
    const reaction = document.createElement('div');
    reaction.className = 'character-guide';
    reaction.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 300; animation: fadeIn 0.5s;';
    reaction.innerHTML = `
        <img src="${avatarPath}" alt="Character" class="char-avatar-img">
        <span class="character-message">${message}</span>
    `;
    document.body.appendChild(reaction);
    
    setTimeout(() => {
        reaction.remove();
    }, 3000);
}
        
        // Actualizar galería (ARREGLADO)
        function updateGallery() {
    const container = document.getElementById('memoriesContainer');
    container.innerHTML = '';
    memories.forEach(memory => {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.onclick = () => openDetailModal(memory.id);
        let thumbnailHtml = '';
        if (memory.isGoogleDrive) {
            thumbnailHtml = `<img src="${memory.thumbnail}" class="memory-thumbnail" alt="Thumbnail" onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48dGV4dCB5PSIuOWVtIiBmb250LXNpemU9IjkwIj7wn5KYPC90ZXh0Pjwvc3ZnPg==';">`;
        } else {
            thumbnailHtml = memory.type === 'video' ? 
                `<video src="${memory.thumbnail || memory.file}" class="memory-thumbnail" muted></video>` :
                `<img src="${memory.thumbnail || memory.file}" class="memory-thumbnail" alt="Thumbnail">`;
        }
        card.innerHTML = `
            ${thumbnailHtml}
            <div class="memory-title">${memory.title}</div>
            <div class="memory-date">Día ${memory.dayNumber}</div>
        `;
        container.appendChild(card);
    });
}
        

        // Actualizar función updateStats para calcular desde el 17 de julio de 2023
        function updateStats() {
            // Calcular estadísticas básicas
            const totalMemories = memories.length;
            const totalVideos = memories.filter(m => m.type === 'video').length;
            
            // Calcular días de aventura desde el 17 de julio de 2023
            const startDate = new Date('2023-07-17');
            const today = new Date();
            const daysOfAdventure = Math.ceil((today - startDate) / (1000 * 60 * 60 * 24));
            
            // Actualizar elementos del DOM
            document.getElementById('totalMemories').textContent = totalMemories;
            document.getElementById('totalVideos').textContent = totalVideos;
            document.getElementById('daysOfAdventure').textContent = daysOfAdventure;
        }

        // Manejar envío del formulario (ARREGLADO)
        document.getElementById('memoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isCreatorMode) return;
            
            if (!currentMemory) {
                alert('Por favor selecciona una foto o video, o proporciona un enlace de Google Drive');
                return;
            }
            
            const title = document.getElementById('titleInput').value;
            const date = document.getElementById('dateInput').value;
            const description = document.getElementById('descriptionInput').value;
            
            // Calcular número de día
            const dayNumber = memories.length + 1;
            
            // Crear nueva memoria
            const newMemory = {
                id: Date.now().toString(),
                title: title,
                date: date,
                dayNumber: dayNumber,
                description: description,
                file: currentMemory.file,
                type: currentMemory.type,
                isGoogleDrive: currentMemory.isGoogleDrive || false,
                character: characters[Math.floor(Math.random() * characters.length)].name,
                createdAt: new Date().toISOString()
            };
            
            // Agregar campos específicos para Google Drive
            if (currentMemory.isGoogleDrive) {
                newMemory.thumbnail = currentMemory.thumbnail;
                newMemory.fileId = currentMemory.fileId;
            }
            
            // Agregar a memorias
            memories.unshift(newMemory);
            saveMemories();
            
            // Actualizar UI
            updateGallery();
            updateStats();
            closeAddModal();
            
            // Mostrar mensaje de éxito con personaje aleatorio
            const character = characters[Math.floor(Math.random() * characters.length)];
            showCharacterReaction(character.phrases[Math.floor(Math.random() * character.phrases.length)], character.avatar);
        });
        
        // Cerrar modales al hacer clic fuera
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
        
    // Registrar el Service Worker (ya se maneja en el DOMContentLoaded modificado)
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
                console.log('Service Worker registrado con éxito:', registration.scope);
            })
            .catch(function(error) {
                console.log('Error al registrar el Service Worker:', error);
            });
    }
    
    // Prevenir zoom en iOS
    document.addEventListener('gesturestart', function (e) {
        e.preventDefault();
    });

    // Agregar navegación con teclado
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('detailModal').classList.contains('active')) {
            if (e.key === 'ArrowLeft') {
                navigateMemory('prev');
            } else if (e.key === 'ArrowRight') {
                navigateMemory('next');
            } else if (e.key === 'Escape') {
                closeDetailModal();
            }
        }
    });
</script>
</body>
</html>
